{% extends 'base.html' %} {% block content %}


<!--****************   The FILTER and SEARCH dropdowns and input fields   *********************************-->
<section>
    <div class="row">
        <div class="col-12 col-md-4">
            <div class="form-group p-2 p-md-4 mr-5" action="">
                <label for="Select1">Filter by Country</label>
                <select class="form-control" id="Select1">
                    <option title="Leave empty if you don't want to filter" value='unfiltered'></option>
                    {% for country in countries %}
                        <option>{{ country }}</option>
                    {% endfor %}    
                </select>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="form-group p-2 p-md-4 mr-5">
                <label for="exampleSelect2">Filter by Category</label>
                <select class="form-control" id="Select2">
                    <option title="Leave empty if you don't want to filter" value='unfiltered'></option>
                    {% for category in categories %}
                        <option>{{ category.category_name }}</option>
                    {% endfor %}    
                </select>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="buttons p-2 p-md-4 mr-5">
                <a href="{{url_for('filtering', search_param = 'selected_category=Seascape&selected_country=Russia')}}" type="button" class="btn btn-outline-warning mt-5" id="filter_button">Let's Gooo... !!!</a>
            </div>
        </div>
    </div>
</section>


<!--****************   The 'POSTCARDS' for displaying database enrtries nicely   *********************************-->
<section>
    <div class="row p-3">
        {% for entry in entries %}
        <div class="col-12 col-sm-6 col-lg-4 col-xl-3 py-3">
            <div class="card bg-light mb-3">
                <div class="card-header">{{entry.category_name}}</div>
                <a class=postcard-link href="{{url_for('display_details', rec_id = entry._id)}}">
                    <img class="postcard-image" id="{{entry._id}}" src="{{entry.image_url}}" alt="Card image">
                </a>
                <div class="card-body">
                    <a class=postcard-title-link href="{{url_for('display_details', rec_id = entry._id)}}">
                        <h4 class="card-title">{{entry.title}}</h4>
                    </a>
                    <span class="card-text postcard-text-left pr-3">{{entry.country}}</span>
                    <span class="card-text postcard-text-left"></span>
                </div>
                <div class="card-footer text-muted">
                    <div class="card-data">
                        <div class='p-1'>
                            <span class='mr-1'>Likes:</span>
                            <span class="badge badge-info">{{ entry.num_of_likes }}</span>
                        </div>
                        <div class='p-1'>
                            <span class='mr-1'>Views:</span>
                            <span class="badge badge-info postcard-text-right">{{ entry.num_of_views }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<!--**********************************  /. The 'POSTCARDS'  ********************************************************************-->

<script>
    
    var selected_country;
    const usp = new URLSearchParams();
    var selectCountry = document.getElementById("Select1");
    var selected_category;
    var selectCategory = document.getElementById("Select2");
    var filterButton = document.getElementById('filter_button');
    var newString;
    
    // Event listener for the country selector drop-down
    selectCountry.addEventListener("change", function() {
        usp.set('selected_country', selectCountry.value);
        newString = "{{url_for('filtering', search_param = ".concat("'?", usp.toString(), "')}}");
        console.log(newString);
        //filterButton.attribute = newString;
    });

    // Event listener for the category selector drop-down
    selectCategory.addEventListener("change", function() {
        usp.set('selected_category', selectCategory.value);
   
        //filterButton.attribute = newString;    
    });
    
    
    
</script>


{% endblock %}
